<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Single EPICS PVs &mdash; ophyd  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Group Signals into Devices" href="device.html" />
    <link rel="prev" title="Installation Tutorial" href="install.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> ophyd
          </a>
              <div class="version">
                1.6.4.post32+g620770b
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Single EPICS PVs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#set-up-for-tutorial">Set up for tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connect-to-a-pv-from-ophyd">Connect to a PV from Ophyd</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-it-with-the-bluesky-runengine">Use it with the Bluesky RunEngine</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-it-directly">Use it directly</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#read">Read</a></li>
<li class="toctree-l3"><a class="reference internal" href="#describe">Describe</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set">Set</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subscribe">Subscribe</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="device.html">Group Signals into Devices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how-to/pseudopositioner.html">Pseudopositioner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/docker.html">Docker setup</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explanations/relationship-to-epics.html">Relationship to EPICS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/area-detector.html">Area Detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/status.html">Status objects (Futures)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/staging.html">Stage and Unstage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/core.html">Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/builtin-devices.html">Devices with Built-in Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/signals.html">Signals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/positioners.html">Positioners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/logging.html">Debugging and Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/release_notes.html">Release History</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bluesky Project</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io">Homepage</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/bluesky">GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://gitter.im/NSLS-II/DAMA">Gitter</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ophyd</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Single EPICS PVs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/single-PV.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="single-epics-pvs">
<h1>Single EPICS PVs<a class="headerlink" href="#single-epics-pvs" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial we will read, write, and monitor an EPICS PV in ophyd.</p>
<section id="set-up-for-tutorial">
<h2>Set up for tutorial<a class="headerlink" href="#set-up-for-tutorial" title="Permalink to this headline">¶</a></h2>
<p>Before you begin, install <code class="docutils literal notranslate"><span class="pre">ophyd</span></code>, <code class="docutils literal notranslate"><span class="pre">pyepics</span></code>, <code class="docutils literal notranslate"><span class="pre">bluesky</span></code>, and <code class="docutils literal notranslate"><span class="pre">caproto</span></code>,
following the <a class="reference internal" href="install.html"><span class="doc">Installation Tutorial</span></a>.</p>
<p>We’ll start this simulated hardware that implements a <a class="reference external" href="https://en.wikipedia.org/wiki/Random_walk">random walk</a>. It has
just two PVs. One is a tunable parameter, <code class="docutils literal notranslate"><span class="pre">random_walk:dt</span></code>, the time between
steps. The other is <code class="docutils literal notranslate"><span class="pre">random_walk:x</span></code>, the current position of the random
walker.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python -m caproto.ioc_examples_random_walk --list-pvs
</pre></div>
</div>
<p>Start your favorite interactive Python environment, such as <code class="docutils literal notranslate"><span class="pre">ipython</span></code> or
<code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">lab</span></code>.</p>
</section>
<section id="connect-to-a-pv-from-ophyd">
<h2>Connect to a PV from Ophyd<a class="headerlink" href="#connect-to-a-pv-from-ophyd" title="Permalink to this headline">¶</a></h2>
<p>Let’s connect to the PV <code class="docutils literal notranslate"><span class="pre">random_walk:dt</span></code> from Ophyd. We need two pieces of
information:</p>
<ul class="simple">
<li><p>The PV name, <code class="docutils literal notranslate"><span class="pre">random_walk:dt</span></code>.</p></li>
<li><p>A human-friendly name. This name is used to label the readings and will be
used in any downstream data analysis or file-writing code. We might choose,
for example, <code class="docutils literal notranslate"><span class="pre">time_delta</span></code>.</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">ophyd.signal</span> <span class="kn">import</span> <span class="n">EpicsSignal</span>

<span class="gp">In [2]: </span><span class="n">time_delta</span> <span class="o">=</span> <span class="n">EpicsSignal</span><span class="p">(</span><span class="s2">&quot;random_walk:dt&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;time_delta&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is <em>conventional</em> to name the Python variable on the left the same as the
value of <code class="docutils literal notranslate"><span class="pre">name</span></code>, but not required. That is, this is conventional…</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">EpicsSignal</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>…but all of these are also allowed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">EpicsSignal</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>  <span class="c1"># local variable different from name</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">EpicsSignal</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;some name with spaces in it&quot;</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="n">EpicsSignal</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>  <span class="c1"># two local variables</span>
</pre></div>
</div>
</div>
<p>Next let’s connect to <code class="docutils literal notranslate"><span class="pre">random_walk:x</span></code>. It happens that this PV is not
writable—any writes would be rejected by EPICS—so we should use a read-only
EpicsSignal, <cite>~ophyd.signal.EPICSSignalRO</cite>, to represent it in in ophyd. In
EPICS, you just have to “know” this about your hardware. Fortunately if, in our
ignorance,  we used writable <cite>~ophyd.signal.EpicsSignal</cite> instead, we could
still use it to read the PV. It would just have a vestigial <code class="docutils literal notranslate"><span class="pre">set()</span></code> method
that wouldn’t work.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="kn">from</span> <span class="nn">ophyd.signal</span> <span class="kn">import</span> <span class="n">EpicsSignalRO</span>

<span class="gp">In [4]: </span><span class="n">x</span> <span class="o">=</span> <span class="n">EpicsSignalRO</span><span class="p">(</span><span class="s2">&quot;random_walk:x&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="use-it-with-the-bluesky-runengine">
<h2>Use it with the Bluesky RunEngine<a class="headerlink" href="#use-it-with-the-bluesky-runengine" title="Permalink to this headline">¶</a></h2>
<p>The signals can be used by the Bluesky RunEngine. Let’s configure a RunEngine
to print a table.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>

<span class="gp">In [6]: </span><span class="kn">from</span> <span class="nn">bluesky.callbacks</span> <span class="kn">import</span> <span class="n">LiveTable</span>

<span class="gp">In [7]: </span><span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">()</span>

<span class="gp">In [8]: </span><span class="n">token</span> <span class="o">=</span> <span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">LiveTable</span><span class="p">([</span><span class="s2">&quot;time_delta&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Because <code class="docutils literal notranslate"><span class="pre">time_delta</span></code> is writable, it can be scanned like a “motor”. It can
also be read like a “detector”. (In Bluesky, all things that are “motors” are
also “detectors”.)</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">count</span><span class="p">,</span> <span class="n">list_scan</span>

<span class="gp">In [10]: </span><span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">time_delta</span><span class="p">]))</span>  <span class="c1"># Use as a &quot;detector&quot;.</span>


<span class="go">+-----------+------------+------------+</span>
<span class="go">|   seq_num |       time | time_delta |</span>
<span class="go">+-----------+------------+------------+</span>
<span class="go">|         1 | 19:34:36.8 |          3 |</span>
<span class="go">+-----------+------------+------------+</span>
<span class="go">generator count [&#39;b0a5f63d&#39;] (scan num: 1)</span>


<span class="gh">Out[10]: </span><span class="go">(&#39;b0a5f63d-e046-4b8d-a1ee-d637df342931&#39;,)</span>

<span class="gp">In [11]: </span><span class="n">RE</span><span class="p">(</span><span class="n">list_scan</span><span class="p">([],</span> <span class="n">time_delta</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>  <span class="c1"># Use as &quot;motor&quot;.</span>


<span class="go">+-----------+------------+------------+</span>
<span class="go">|   seq_num |       time | time_delta |</span>
<span class="go">+-----------+------------+------------+</span>
<span class="go">|         1 | 19:34:36.9 |          0 |</span>
<span class="go">|         2 | 19:34:36.9 |          0 |</span>
<span class="go">|         3 | 19:34:36.9 |          1 |</span>
<span class="go">|         4 | 19:34:36.9 |          3 |</span>
<span class="go">+-----------+------------+------------+</span>
<span class="go">generator list_scan [&#39;b9739d54&#39;] (scan num: 2)</span>


<span class="gh">Out[11]: </span><span class="go">(&#39;b9739d54-c018-45b5-b291-aed0a3bbdedc&#39;,)</span>
</pre></div>
</div>
<p>For the following example, set <code class="docutils literal notranslate"><span class="pre">time_delta</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [12]: </span><span class="kn">from</span> <span class="nn">bluesky.plan_stubs</span> <span class="kn">import</span> <span class="n">mv</span>

<span class="gp">In [13]: </span><span class="n">RE</span><span class="p">(</span><span class="n">mv</span><span class="p">(</span><span class="n">time_delta</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="gh">Out[13]: </span><span class="go">()</span>
</pre></div>
</div>
<p>We know that <code class="docutils literal notranslate"><span class="pre">x</span></code> represents a time-dependent variable. We can “poll” it at
regular intervals</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [14]: </span><span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>  <span class="c1"># Read every 0.5 seconds.</span>


<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">|   seq_num |       time | time_delta |          x |</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">|         1 | 19:34:37.1 |            |         -0 |</span>
<span class="go">|         2 | 19:34:37.6 |            |         -0 |</span>
<span class="go">|         3 | 19:34:38.1 |            |         -0 |</span>
<span class="go">|         4 | 19:34:38.6 |            |          0 |</span>
<span class="go">|         5 | 19:34:39.1 |            |          0 |</span>
<span class="go">+-----------+------------+------------+------------+</span>
<span class="go">generator count [&#39;cadb65de&#39;] (scan num: 3)</span>


<span class="gh">Out[14]: </span><span class="go">(&#39;cadb65de-4c62-4efc-b52b-168111777ea0&#39;,)</span>
</pre></div>
</div>
<p>but this required us to choose an update frequency (<code class="docutils literal notranslate"><span class="pre">0.5</span></code>). It’s often better
to rely on the control system to <em>tell</em> us when a new value is available. In
this example, we accumulate updates for <code class="docutils literal notranslate"><span class="pre">x</span></code> whenever it changes.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [15]: </span><span class="kn">from</span> <span class="nn">bluesky.plan_stubs</span> <span class="kn">import</span> <span class="n">monitor</span><span class="p">,</span> <span class="n">unmonitor</span><span class="p">,</span> <span class="n">open_run</span><span class="p">,</span> <span class="n">close_run</span><span class="p">,</span> <span class="n">sleep</span>

<span class="gp">In [16]: </span><span class="k">def</span> <span class="nf">monitor_x_for</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="k">yield from</span> <span class="n">open_run</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>  <span class="c1"># optional metadata</span>
<span class="gp">   ....: </span>    <span class="k">yield from</span> <span class="n">monitor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;x_monitor&quot;</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="k">yield from</span> <span class="n">sleep</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>  <span class="c1"># Wait for readings to accumulate.</span>
<span class="gp">   ....: </span>    <span class="k">yield from</span> <span class="n">unmonitor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="k">yield from</span> <span class="n">close_run</span><span class="p">()</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="n">RE</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>  <span class="c1"># Remove the old table.</span>

<span class="gp">In [18]: </span><span class="n">RE</span><span class="p">(</span><span class="n">monitor_x_for</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">LiveTable</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">stream_name</span><span class="o">=</span><span class="s2">&quot;x_monitor&quot;</span><span class="p">))</span>


<span class="go">+-----------+------------+------------+</span>
<span class="go">|   seq_num |       time |          x |</span>
<span class="go">+-----------+------------+------------+</span>
<span class="go">|         1 | 19:34:39.7 |         -1 |</span>
<span class="go">|         2 | 19:34:39.7 |         -1 |</span>
<span class="go">|         3 | 19:34:40.5 |         -1 |</span>
<span class="go">|         4 | 19:34:41.5 |         -1 |</span>
<span class="go">|         5 | 19:34:42.5 |         -2 |</span>
<span class="go">+-----------+------------+------------+</span>
<span class="go">generator monitor_x_for [&#39;3a50580a&#39;] (scan num: 4)</span>


<span class="gh">Out[18]: </span><span class="go">(&#39;3a50580a-66ba-4bf7-a3f6-d455306d9d1d&#39;,)</span>
</pre></div>
</div>
<p>If you are a scientist aiming to use Ophyd with the Bluesky Run Engine, you may
stop at this point or read on to learn more about how the Run Engine interacts
with these signals. If you are a controls engineer, the details that follow are
likely important to you.</p>
</section>
<section id="use-it-directly">
<h2>Use it directly<a class="headerlink" href="#use-it-directly" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These methods should <em>not</em> be called inside a Bluesky plan.
See [TODO link to explanation.]</p>
</div>
<section id="read">
<h3>Read<a class="headerlink" href="#read" title="Permalink to this headline">¶</a></h3>
<p>The signal can be read. It return a dictionary with one item. The key is the
human-friendly <code class="docutils literal notranslate"><span class="pre">name</span></code> we specified. The value is another dictionary,
containing the <code class="docutils literal notranslate"><span class="pre">value</span></code> and the <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> of the reading from the control
system (in this case, EPICS).</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">time_delta</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gh">Out[19]: </span><span class="go">{&#39;time_delta&#39;: {&#39;value&#39;: 1.0, &#39;timestamp&#39;: 1652211277.09191}}</span>
</pre></div>
</div>
</section>
<section id="describe">
<h3>Describe<a class="headerlink" href="#describe" title="Permalink to this headline">¶</a></h3>
<p>Additional metadata is available. This always includes the data type, shape,
and source (e.g.  PV). It may also include units and other metadata.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [20]: </span><span class="n">time_delta</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="gh">Out[20]: </span><span class="go"></span>
<span class="go">{&#39;time_delta&#39;: {&#39;source&#39;: &#39;PV:random_walk:dt&#39;,</span>
<span class="go">  &#39;dtype&#39;: &#39;number&#39;,</span>
<span class="go">  &#39;shape&#39;: [],</span>
<span class="go">  &#39;units&#39;: &#39;&#39;,</span>
<span class="go">  &#39;lower_ctrl_limit&#39;: 0.0,</span>
<span class="go">  &#39;upper_ctrl_limit&#39;: 0.0,</span>
<span class="go">  &#39;precision&#39;: 0}}</span>
</pre></div>
</div>
</section>
<section id="set">
<h3>Set<a class="headerlink" href="#set" title="Permalink to this headline">¶</a></h3>
<p>This signal is writable, so it can also be set.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="n">time_delta</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>  <span class="c1"># Set it to 10 and wait for it to get there.</span>
</pre></div>
</div>
<p>Sometimes hardware gets stuck or does not do what it is told, and so it is good
practice to put a timeout on how long you are willing to wait until deciding
that there is an error that needs to be handled somehow.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [22]: </span><span class="n">time_delta</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Set it to 10 and wait up to 1 second.</span>
</pre></div>
</div>
<p>If the signal fails to arrive, a <code class="docutils literal notranslate"><span class="pre">TimeoutError</span></code> will be raised.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">set(...)</span></code> starts the motion but does <em>not</em> wait for it to
complete. It is a fast, “non-blocking” operation. This enables you to run
code between starting a motion and completing it.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [23]: </span><span class="n">status</span> <span class="o">=</span> <span class="n">time_delta</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="gp">In [24]: </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Moving to 5...&quot;</span><span class="p">)</span>
<span class="go">Moving to 5...</span>

<span class="gp">In [25]: </span><span class="n">status</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">In [26]: </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Moved to 5.&quot;</span><span class="p">)</span>
<span class="go">Moved to 5.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To move more than one signal in parallel, use the <a class="reference internal" href="../generated/ophyd.status.wait.html#ophyd.status.wait" title="ophyd.status.wait"><code class="xref py py-func docutils literal notranslate"><span class="pre">ophyd.status.wait()</span></code></a>
<em>function</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd.status</span> <span class="kn">import</span> <span class="n">wait</span>

<span class="c1"># Given signals a and b, set both in motion.</span>
<span class="n">status1</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">status2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Wait for both to complete.</span>
<span class="n">wait</span><span class="p">(</span><span class="n">status1</span><span class="p">,</span> <span class="n">status2</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For more on what you can do with <code class="docutils literal notranslate"><span class="pre">status</span></code>, see […].</p>
</section>
<section id="subscribe">
<h3>Subscribe<a class="headerlink" href="#subscribe" title="Permalink to this headline">¶</a></h3>
<p>What’s the best way to read a signal that changes over time, like our <code class="docutils literal notranslate"><span class="pre">x</span></code>
signal?</p>
<p>First, set <code class="docutils literal notranslate"><span class="pre">time_delta</span></code> to a reasonable value like <code class="docutils literal notranslate"><span class="pre">1</span></code>. This controls the
update rate of <code class="docutils literal notranslate"><span class="pre">x</span></code> in our random walk simulation.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [27]: </span><span class="n">time_delta</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
<p>We could poll the signal in a loop and collect N readings spaced T seconds
apart.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Don&#39;t do this.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">readings</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="n">reading</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">readings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reading</span><span class="p">)</span>
</pre></div>
</div>
<p>There are two problems with this counterexample.</p>
<ol class="arabic simple">
<li><p>We might not know how often we need to check for updates.</p></li>
<li><p>We often want to watch <em>multiple</em> signals with different update rates, and
this pattern would quickly become messy.</p></li>
</ol>
<p>Alternatively, we can use <em>subscription</em>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [28]: </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>

<span class="gp">In [29]: </span><span class="k">def</span> <span class="nf">accumulate</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">old_value</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="n">readings</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">}})</span>
<span class="gp">   ....: </span><span class="n">readings</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">   ....: </span><span class="n">x</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">accumulate</span><span class="p">)</span>
<span class="gp">   ....: </span>
<span class="gh">Out[29]: </span><span class="go">1</span>
</pre></div>
</div>
<p>When the control system has a new <code class="docutils literal notranslate"><span class="pre">reading</span></code> for us, it calls
<code class="docutils literal notranslate"><span class="pre">readings.append(reading)</span></code> from a background thread. If we do other work or
sleep for awhile and then check back on <code class="docutils literal notranslate"><span class="pre">readings</span></code> we’ll see that it has some
items in it.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [30]: </span><span class="n">readings</span>
<span class="gh">Out[30]: </span><span class="go"></span>
<span class="go">deque([{&#39;x&#39;: {&#39;value&#39;: -1.3522425182520934, &#39;timestamp&#39;: 1652211283.504534}},</span>
<span class="go">       {&#39;x&#39;: {&#39;value&#39;: -1.4743218791640582, &#39;timestamp&#39;: 1652211284.50521}},</span>
<span class="go">       {&#39;x&#39;: {&#39;value&#39;: -1.4743218791640582, &#39;timestamp&#39;: 1652211284.50521}},</span>
<span class="go">       {&#39;x&#39;: {&#39;value&#39;: -1.1194334975854447, &#39;timestamp&#39;: 1652211285.507115}},</span>
<span class="go">       {&#39;x&#39;: {&#39;value&#39;: -1.1194334975854447, &#39;timestamp&#39;: 1652211285.507115}}])</span>
</pre></div>
</div>
<p>It will keep the last <code class="docutils literal notranslate"><span class="pre">5</span></code>. We used a <a class="reference external" href="https://docs.python.org/3/library/collections.html#collections.deque" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">deque</span></code></a> instead of a
plain <cite>list</cite> here because a <cite>list</cite> would grow without bound and, if left to
run long enough, consume all available memory, crashing the program.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="install.html" class="btn btn-neutral float-left" title="Installation Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="device.html" class="btn btn-neutral float-right" title="Group Signals into Devices" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014, Brookhaven National Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>