<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>E4CV : 4-circle diffractometer example &mdash; hklpy 0+untagged.1.g906f00e.dirty documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="E6C : 6-circle diffractometer example" href="geo_e6c.html" />
    <link rel="prev" title="Examples" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> hklpy
          </a>
              <div class="version">
                0+untagged.1.g906f00e.dirty
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Core Functionality</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Ready-to-Use Devices</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../ready_to_use.html">Ready-to-Use Devices</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#diffractometer-geometries">Diffractometer Geometries</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">E4CV : 4-circle diffractometer example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#load-the-hklpy-package-named-hkl">Load the <em>hklpy</em> package (named <em>hkl</em>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup-the-e4cv-diffractometer-in-hklpy">Setup the <em>E4CV</em> diffractometer in <em>hklpy</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-this-diffractometer">Define <em>this</em> diffractometer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-a-sample-with-a-crystal-structure">Add a sample with a crystal structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup-the-ub-orientation-matrix-using-hklpy">Setup the UB orientation matrix using <em>hklpy</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#report-what-we-have-setup">Report what we have setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#check-the-orientation-matrix">Check the orientation matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scan-in-reciprocal-space-using-bluesky">Scan in reciprocal space using Bluesky</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="geo_e6c.html">E6C : 6-circle diffractometer example</a></li>
<li class="toctree-l3"><a class="reference internal" href="geo_k4cv.html">K4CV : 4-circle kappa diffractometer example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#how-to-guides">How-to Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#variations">Variations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tests-and-comparisons">Tests and Comparisons</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">hklpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Examples</a> &raquo;</li>
      <li>E4CV : 4-circle diffractometer example</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/examples/notebooks/geo_e4cv.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="e4cv-4-circle-diffractometer-example">
<h1>E4CV : 4-circle diffractometer example<a class="headerlink" href="#e4cv-4-circle-diffractometer-example" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="http://ww1.iucr.org/iucr-top/comm/cteach/pamphlets/2/node14.html">IUCr provides a schematic of the 4-circle
diffractometer</a>
(in horizontal geometry typical of a laboratory instrument).</p>
<!-- image source:
  http://ww1.iucr.org/iucr-top/comm/cteach/pamphlets/2/
  --><figure class="align-default" id="id2">
<img alt="E4CH geometry" src="../../_images/img69.gif" />
<figcaption>
<p><span class="caption-text">E4CH geometry</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>At X-ray synchrotrons, the vertical geometry is more common due to the
polarization of the X-rays.</p>
<hr class="docutils" />
<p>Note: This example is available as a <a class="reference external" href="https://jupyter.org/">Jupyter
notebook</a> from the <em>hklpy</em> source code website:
<a class="reference external" href="https://github.com/bluesky/hklpy/tree/main/examples">https://github.com/bluesky/hklpy/tree/main/examples</a></p>
<section id="load-the-hklpy-package-named-hkl">
<h2>Load the <em>hklpy</em> package (named <em>hkl</em>)<a class="headerlink" href="#load-the-hklpy-package-named-hkl" title="Permalink to this headline">¶</a></h2>
<p>Since the <em>hklpy</em> package is a thin interface to the <em>hkl</em> library
(compiled C++ code), we need to <strong>first</strong> load the
<em>gobject-introspection</em> package (named <em>``gi``</em>) and name our required
code and version.</p>
<p>This is needed <em>every</em> time before the <em>hkl</em> package is first imported.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gi</span>
<span class="n">gi</span><span class="o">.</span><span class="n">require_version</span><span class="p">(</span><span class="s1">&#39;Hkl&#39;</span><span class="p">,</span> <span class="s1">&#39;5.0&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="setup-the-e4cv-diffractometer-in-hklpy">
<h2>Setup the <em>E4CV</em> diffractometer in <em>hklpy</em><a class="headerlink" href="#setup-the-e4cv-diffractometer-in-hklpy" title="Permalink to this headline">¶</a></h2>
<p>In <em>hkl</em> <em>E4CV</em> geometry
(<a class="reference external" href="https://people.debian.org/~picca/hkl/hkl.html#org7ef08ba">https://people.debian.org/~picca/hkl/hkl.html#org7ef08ba</a>):</p>
<figure class="align-default" id="id3">
<img alt="E4CV geometry" src="../../_images/3S+1D.png" />
<figcaption>
<p><span class="caption-text">E4CV geometry</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>xrays incident on the <span class="math notranslate nohighlight">\(\vec{x}\)</span> direction (1, 0, 0)</p></li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 12%" />
<col style="width: 20%" />
<col style="width: 39%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>axis</p></th>
<th class="head"><p>moves</p></th>
<th class="head"><p>rotation axis</p></th>
<th class="head"><p>vector</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>omega</p></td>
<td><p>sample</p></td>
<td><p><span class="math notranslate nohighlight">\(-\vec{y}\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">-1</span> <span class="pre">0]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>chi</p></td>
<td><p>sample</p></td>
<td><p><span class="math notranslate nohighlight">\(\vec{x}\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[1</span> <span class="pre">0</span> <span class="pre">0]</span></code></p></td>
</tr>
<tr class="row-even"><td><p>phi</p></td>
<td><p>sample</p></td>
<td><p><span class="math notranslate nohighlight">\(-\vec{y}\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">-1</span> <span class="pre">0]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>tth</p></td>
<td><p>detector</p></td>
<td><p><span class="math notranslate nohighlight">\(-\vec{y}\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">-1</span> <span class="pre">0]</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="define-this-diffractometer">
<h2>Define <em>this</em> diffractometer<a class="headerlink" href="#define-this-diffractometer" title="Permalink to this headline">¶</a></h2>
<p>Create a Python class that specifies the names of the real-space
positioners. We call it <code class="docutils literal notranslate"><span class="pre">FourCircle</span></code> here but that choice is
arbitrary. Pick any valid Python name not already in use. The convention
is to start Python class names with a capital letter and use CamelCase
to mark word starts.</p>
<p>The argument to the <code class="docutils literal notranslate"><span class="pre">FourCircle()</span></code> class tells which <em>hklpy</em> base
class will be used. This sets the geometry. (The class we show here
could be replaced entirely with <code class="docutils literal notranslate"><span class="pre">hkl.geometries.SimulatedE4CV</span></code> but we
choose to show here the complete steps to produce that class.) The
<a class="reference external" href="https://blueskyproject.io/hklpy/master/geometries.html">hklpy
documentation</a>
provides a complete list of diffractometer geometries.</p>
<p>In <em>hklpy</em>, the reciprocal-space axes are known as <code class="docutils literal notranslate"><span class="pre">pseudo</span></code>
positioners while the real-space axes are known as <code class="docutils literal notranslate"><span class="pre">real</span></code> positioners.
For the real positioners, it is possible to use different names than the
canonical names used internally by the <em>hkl</em> library. That is not
covered here.</p>
<p>Note: The keyword argument <code class="docutils literal notranslate"><span class="pre">kind=&quot;hinted&quot;</span></code> is an indication that this
signal may be plotted.</p>
<p>This <code class="docutils literal notranslate"><span class="pre">FourCircle()</span></code> class example uses simulated motors. See the
drop-down for an example how to use EPICS motors.</p>
<details><summary><p>FourCircle() class using EPICS motors</p>
</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hkl</span> <span class="kn">import</span> <span class="n">E4CV</span>
<span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">EpicsMotor</span><span class="p">,</span> <span class="n">PseudoSingle</span>
<span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">Component</span> <span class="k">as</span> <span class="n">Cpt</span>

<span class="k">class</span> <span class="nc">FourCircle</span><span class="p">(</span><span class="n">E4CV</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Our 4-circle.  Eulerian.  Vertical scattering orientation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># the reciprocal axes are called &quot;pseudo&quot; in hklpy</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">PseudoSingle</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">PseudoSingle</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">PseudoSingle</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">)</span>

    <span class="c1"># the motor axes are called &quot;real&quot; in hklpy</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">EpicsMotor</span><span class="p">,</span> <span class="s2">&quot;pv_prefix:m41&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">)</span>
    <span class="n">chi</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">EpicsMotor</span><span class="p">,</span> <span class="s2">&quot;pv_prefix:m22&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">EpicsMotor</span><span class="p">,</span> <span class="s2">&quot;pv_prefix:m35&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">)</span>
    <span class="n">tth</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">EpicsMotor</span><span class="p">,</span> <span class="s2">&quot;pv_prefix:m7&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">)</span>
</pre></div>
</div>
</details><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hkl</span> <span class="kn">import</span> <span class="n">E4CV</span><span class="p">,</span> <span class="n">SimMixin</span>
<span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">SoftPositioner</span>
<span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">Component</span> <span class="k">as</span> <span class="n">Cpt</span>

<span class="k">class</span> <span class="nc">FourCircle</span><span class="p">(</span><span class="n">SimMixin</span><span class="p">,</span> <span class="n">E4CV</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Our 4-circle.  Eulerian, vertical scattering orientation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># the reciprocal axes are defined by SimMixin</span>

    <span class="n">omega</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">SoftPositioner</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">,</span> <span class="n">init_pos</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">chi</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">SoftPositioner</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">,</span> <span class="n">init_pos</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">SoftPositioner</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">,</span> <span class="n">init_pos</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tth</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">SoftPositioner</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;hinted&quot;</span><span class="p">,</span> <span class="n">init_pos</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Create the Python diffractometer object (<code class="docutils literal notranslate"><span class="pre">fourc</span></code>) using the
<code class="docutils literal notranslate"><span class="pre">FourCircle()</span></code> class. By convention, the <code class="docutils literal notranslate"><span class="pre">name</span></code> keyword is the same
as the object name.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fourc</span> <span class="o">=</span> <span class="n">FourCircle</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;fourc&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="add-a-sample-with-a-crystal-structure">
<h2>Add a sample with a crystal structure<a class="headerlink" href="#add-a-sample-with-a-crystal-structure" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hkl</span> <span class="kn">import</span> <span class="n">Lattice</span>
<span class="kn">from</span> <span class="nn">hkl</span> <span class="kn">import</span> <span class="n">SI_LATTICE_PARAMETER</span>

<span class="c1"># add the sample to the calculation engine</span>
<span class="n">a0</span> <span class="o">=</span> <span class="n">SI_LATTICE_PARAMETER</span>
<span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">new_sample</span><span class="p">(</span>
    <span class="s2">&quot;silicon&quot;</span><span class="p">,</span>
    <span class="n">lattice</span><span class="o">=</span><span class="n">Lattice</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">a0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">a0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HklSample</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;silicon&#39;</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="n">LatticeTuple</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">5.431020511</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">5.431020511</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">5.431020511</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">90.0</span><span class="p">),</span> <span class="n">ux</span><span class="o">=</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;None (internally: ux)&#39;</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mf">180.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">180.0</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inverted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Degree&#39;</span><span class="p">),</span> <span class="n">uy</span><span class="o">=</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;None (internally: uy)&#39;</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mf">180.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">180.0</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inverted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Degree&#39;</span><span class="p">),</span> <span class="n">uz</span><span class="o">=</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;None (internally: uz)&#39;</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="nb">min</span><span class="o">=-</span><span class="mf">180.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">180.0</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inverted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Degree&#39;</span><span class="p">),</span> <span class="n">U</span><span class="o">=</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
       <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]),</span> <span class="n">UB</span><span class="o">=</span><span class="n">array</span><span class="p">([[</span> <span class="mf">1.15690694e+00</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.08401189e-17</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.08401189e-17</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.00000000e+00</span><span class="p">,</span>  <span class="mf">1.15690694e+00</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.08401189e-17</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.00000000e+00</span><span class="p">,</span>  <span class="mf">0.00000000e+00</span><span class="p">,</span>  <span class="mf">1.15690694e+00</span><span class="p">]]),</span> <span class="n">reflections</span><span class="o">=</span><span class="p">[])</span>
</pre></div>
</div>
</section>
<section id="setup-the-ub-orientation-matrix-using-hklpy">
<h2>Setup the UB orientation matrix using <em>hklpy</em><a class="headerlink" href="#setup-the-ub-orientation-matrix-using-hklpy" title="Permalink to this headline">¶</a></h2>
<p>Define the crystal’s orientation on the diffractometer using the
2-reflection method described by <a class="reference external" href="https://www.psi.ch/sites/default/files/import/sinq/zebra/PracticalsEN/1967-Busing-Levy-3-4-circle-Acta22.pdf">Busing &amp; Levy, Acta Cryst 22 (1967)
457</a>.</p>
<section id="set-the-same-x-ray-wavelength-for-both-reflections-by-setting-the-diffractometer-energy">
<h3>Set the same X-ray wavelength for both reflections, by setting the diffractometer energy<a class="headerlink" href="#set-the-same-x-ray-wavelength-for-both-reflections-by-setting-the-diffractometer-energy" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hkl</span> <span class="kn">import</span> <span class="n">A_KEV</span>
<span class="n">fourc</span><span class="o">.</span><span class="n">energy</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">A_KEV</span> <span class="o">/</span> <span class="mf">1.54</span><span class="p">)</span>  <span class="c1"># (8.0509 keV)</span>
</pre></div>
</div>
</section>
<section id="specify-the-first-reflection-and-identify-its-miller-indices-hkl">
<h3>Specify the first reflection and identify its Miller indices: (<em>hkl</em>)<a class="headerlink" href="#specify-the-first-reflection-and-identify-its-miller-indices-hkl" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r1</span> <span class="o">=</span> <span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">add_reflection</span><span class="p">(</span>
    <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">position</span><span class="o">=</span><span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">Position</span><span class="p">(</span>
        <span class="n">tth</span><span class="o">=</span><span class="mf">69.0966</span><span class="p">,</span>
        <span class="n">omega</span><span class="o">=-</span><span class="mf">145.451</span><span class="p">,</span>
        <span class="n">chi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">phi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="specify-the-second-reflection">
<h3>Specify the second reflection<a class="headerlink" href="#specify-the-second-reflection" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2</span> <span class="o">=</span> <span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">add_reflection</span><span class="p">(</span>
    <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">position</span><span class="o">=</span><span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">Position</span><span class="p">(</span>
        <span class="n">tth</span><span class="o">=</span><span class="mf">69.0966</span><span class="p">,</span>
        <span class="n">omega</span><span class="o">=-</span><span class="mf">145.451</span><span class="p">,</span>
        <span class="n">chi</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
        <span class="n">phi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="compute-the-ub-orientation-matrix">
<h3>Compute the <em>UB</em> orientation matrix<a class="headerlink" href="#compute-the-ub-orientation-matrix" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">add_reflection()</span></code> method uses the current wavelength at the time
it is called. (To add reflections at different wavelengths, change the
wavelength <em>before</em> calling <code class="docutils literal notranslate"><span class="pre">add_reflection()</span></code> each time.) The
<code class="docutils literal notranslate"><span class="pre">compute_UB()</span></code> method returns the computed <strong>UB</strong> matrix. Ignore it
here.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">compute_UB</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1.41342846e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.41342846e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.15690694e+00</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.00000000e+00</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.15690694e+00</span><span class="p">,</span>  <span class="mf">1.41342846e-05</span><span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">1.15690694e+00</span><span class="p">,</span>  <span class="mf">1.72682934e-10</span><span class="p">,</span>  <span class="mf">1.41342846e-05</span><span class="p">]])</span>
</pre></div>
</div>
</section>
</section>
<section id="report-what-we-have-setup">
<h2>Report what we have setup<a class="headerlink" href="#report-what-we-have-setup" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fourc</span><span class="o">.</span><span class="n">pa</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=====================</span> <span class="o">===========================================================================</span>
<span class="n">term</span>                  <span class="n">value</span>
<span class="o">=====================</span> <span class="o">===========================================================================</span>
<span class="n">diffractometer</span>        <span class="n">fourc</span>
<span class="n">geometry</span>              <span class="n">E4CV</span>
<span class="k">class</span>                 <span class="nc">FourCircle</span>
<span class="n">energy</span> <span class="p">(</span><span class="n">keV</span><span class="p">)</span>          <span class="mf">8.05092</span>
<span class="n">wavelength</span> <span class="p">(</span><span class="n">angstrom</span><span class="p">)</span> <span class="mf">1.54000</span>
<span class="n">calc</span> <span class="n">engine</span>           <span class="n">hkl</span>
<span class="n">mode</span>                  <span class="n">bissector</span>
<span class="n">positions</span>             <span class="o">=====</span> <span class="o">=======</span>
                      <span class="n">name</span>  <span class="n">value</span>
                      <span class="o">=====</span> <span class="o">=======</span>
                      <span class="n">omega</span> <span class="mf">0.00000</span>
                      <span class="n">chi</span>   <span class="mf">0.00000</span>
                      <span class="n">phi</span>   <span class="mf">0.00000</span>
                      <span class="n">tth</span>   <span class="mf">0.00000</span>
                      <span class="o">=====</span> <span class="o">=======</span>
<span class="n">constraints</span>           <span class="o">=====</span> <span class="o">=========</span> <span class="o">==========</span> <span class="o">=====</span> <span class="o">====</span>
                      <span class="n">axis</span>  <span class="n">low_limit</span> <span class="n">high_limit</span> <span class="n">value</span> <span class="n">fit</span>
                      <span class="o">=====</span> <span class="o">=========</span> <span class="o">==========</span> <span class="o">=====</span> <span class="o">====</span>
                      <span class="n">omega</span> <span class="o">-</span><span class="mf">180.0</span>    <span class="mf">180.0</span>      <span class="mf">0.0</span>   <span class="kc">True</span>
                      <span class="n">chi</span>   <span class="o">-</span><span class="mf">180.0</span>    <span class="mf">180.0</span>      <span class="mf">0.0</span>   <span class="kc">True</span>
                      <span class="n">phi</span>   <span class="o">-</span><span class="mf">180.0</span>    <span class="mf">180.0</span>      <span class="mf">0.0</span>   <span class="kc">True</span>
                      <span class="n">tth</span>   <span class="o">-</span><span class="mf">180.0</span>    <span class="mf">180.0</span>      <span class="mf">0.0</span>   <span class="kc">True</span>
                      <span class="o">=====</span> <span class="o">=========</span> <span class="o">==========</span> <span class="o">=====</span> <span class="o">====</span>
<span class="n">sample</span><span class="p">:</span> <span class="n">silicon</span>       <span class="o">=================</span> <span class="o">=========================================================</span>
                      <span class="n">term</span>              <span class="n">value</span>
                      <span class="o">=================</span> <span class="o">=========================================================</span>
                      <span class="n">unit</span> <span class="n">cell</span> <span class="n">edges</span>   <span class="n">a</span><span class="o">=</span><span class="mf">5.431020511</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">5.431020511</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">5.431020511</span>
                      <span class="n">unit</span> <span class="n">cell</span> <span class="n">angles</span>  <span class="n">alpha</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">90.0</span>
                      <span class="n">ref</span> <span class="mi">1</span> <span class="p">(</span><span class="n">hkl</span><span class="p">)</span>       <span class="n">h</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.0</span>
                      <span class="n">ref</span> <span class="mi">1</span> <span class="n">positioners</span> <span class="n">omega</span><span class="o">=-</span><span class="mf">145.45100</span><span class="p">,</span> <span class="n">chi</span><span class="o">=</span><span class="mf">0.00000</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="mf">0.00000</span><span class="p">,</span> <span class="n">tth</span><span class="o">=</span><span class="mf">69.09660</span>
                      <span class="n">ref</span> <span class="mi">2</span> <span class="p">(</span><span class="n">hkl</span><span class="p">)</span>       <span class="n">h</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mf">0.0</span>
                      <span class="n">ref</span> <span class="mi">2</span> <span class="n">positioners</span> <span class="n">omega</span><span class="o">=-</span><span class="mf">145.45100</span><span class="p">,</span> <span class="n">chi</span><span class="o">=</span><span class="mf">90.00000</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="mf">0.00000</span><span class="p">,</span> <span class="n">tth</span><span class="o">=</span><span class="mf">69.09660</span>
                      <span class="p">[</span><span class="n">U</span><span class="p">]</span>               <span class="p">[[</span><span class="o">-</span><span class="mf">1.22173048e-05</span> <span class="o">-</span><span class="mf">1.22173048e-05</span> <span class="o">-</span><span class="mf">1.00000000e+00</span><span class="p">]</span>
                                         <span class="p">[</span> <span class="mf">0.00000000e+00</span> <span class="o">-</span><span class="mf">1.00000000e+00</span>  <span class="mf">1.22173048e-05</span><span class="p">]</span>
                                         <span class="p">[</span><span class="o">-</span><span class="mf">1.00000000e+00</span>  <span class="mf">1.49262536e-10</span>  <span class="mf">1.22173048e-05</span><span class="p">]]</span>
                      <span class="p">[</span><span class="n">UB</span><span class="p">]</span>              <span class="p">[[</span><span class="o">-</span><span class="mf">1.41342846e-05</span> <span class="o">-</span><span class="mf">1.41342846e-05</span> <span class="o">-</span><span class="mf">1.15690694e+00</span><span class="p">]</span>
                                         <span class="p">[</span> <span class="mf">0.00000000e+00</span> <span class="o">-</span><span class="mf">1.15690694e+00</span>  <span class="mf">1.41342846e-05</span><span class="p">]</span>
                                         <span class="p">[</span><span class="o">-</span><span class="mf">1.15690694e+00</span>  <span class="mf">1.72682934e-10</span>  <span class="mf">1.41342846e-05</span><span class="p">]]</span>
                      <span class="o">=================</span> <span class="o">=========================================================</span>
<span class="o">=====================</span> <span class="o">===========================================================================</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">pyRestTable</span><span class="o">.</span><span class="n">rest_table</span><span class="o">.</span><span class="n">Table</span> <span class="n">at</span> <span class="mh">0x7f52eadf1820</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="check-the-orientation-matrix">
<h2>Check the orientation matrix<a class="headerlink" href="#check-the-orientation-matrix" title="Permalink to this headline">¶</a></h2>
<p>Perform checks with <em>forward</em> (hkl to angle) and <em>inverse</em> (angle to
hkl) computations to verify the diffractometer will move to the same
positions where the reflections were identified.</p>
<section id="constrain-the-motors-to-limited-ranges">
<h3>Constrain the motors to limited ranges<a class="headerlink" href="#constrain-the-motors-to-limited-ranges" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>allow for slight roundoff errors</p></li>
<li><p>keep <code class="docutils literal notranslate"><span class="pre">tth</span></code> in the positive range</p></li>
<li><p>keep <code class="docutils literal notranslate"><span class="pre">omega</span></code> in the negative range</p></li>
<li><p>keep <code class="docutils literal notranslate"><span class="pre">phi</span></code> fixed at zero</p></li>
</ul>
<p>First, we apply constraints directly to the <code class="docutils literal notranslate"><span class="pre">calc</span></code>-level support.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="p">[</span><span class="s2">&quot;tth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">limits</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
<span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="p">[</span><span class="s2">&quot;omega&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">limits</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
<span class="n">fourc</span><span class="o">.</span><span class="n">show_constraints</span><span class="p">()</span>

<span class="n">fourc</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">fourc</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;constant_phi&quot;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=====</span> <span class="o">=========</span> <span class="o">==========</span> <span class="o">=====</span> <span class="o">====</span>
<span class="n">axis</span>  <span class="n">low_limit</span> <span class="n">high_limit</span> <span class="n">value</span> <span class="n">fit</span>
<span class="o">=====</span> <span class="o">=========</span> <span class="o">==========</span> <span class="o">=====</span> <span class="o">====</span>
<span class="n">omega</span> <span class="o">-</span><span class="mf">180.0</span>    <span class="mf">0.001</span>      <span class="mf">0.0</span>   <span class="kc">True</span>
<span class="n">chi</span>   <span class="o">-</span><span class="mf">180.0</span>    <span class="mf">180.0</span>      <span class="mf">0.0</span>   <span class="kc">True</span>
<span class="n">phi</span>   <span class="o">-</span><span class="mf">180.0</span>    <span class="mf">180.0</span>      <span class="mf">0.0</span>   <span class="kc">True</span>
<span class="n">tth</span>   <span class="o">-</span><span class="mf">0.001</span>    <span class="mf">180.0</span>      <span class="mf">0.0</span>   <span class="kc">True</span>
<span class="o">=====</span> <span class="o">=========</span> <span class="o">==========</span> <span class="o">=====</span> <span class="o">====</span>
</pre></div>
</div>
<p>Next, we show how to use additional methods of <code class="docutils literal notranslate"><span class="pre">Diffractometer()</span></code> that
support <em>undo</em> and <em>reset</em> features for applied constraints. The support
is based on a <em>stack</em> (a Python list). A set of constraints is added
(<code class="docutils literal notranslate"><span class="pre">apply_constraints()</span></code>) or removed (<code class="docutils literal notranslate"><span class="pre">undo_last_constraints()</span></code>) from
the stack. Or, the stack can be cleared (<code class="docutils literal notranslate"><span class="pre">reset_constraints()</span></code>).</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>method</p></th>
<th class="head"><p>what happens</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">apply_constraints()</span></code></p></td>
<td><p>Add a set of constraints and use
them</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">undo_last_constraints()</span></code></p></td>
<td><p>Remove the most-recent set of
constraints and restore the
previous one from the stack.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">reset_constraints()</span></code></p></td>
<td><p>Set constraints back to initial
settings.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">show_constraints()</span></code></p></td>
<td><p>Print the current constraints in
a table.</p></td>
</tr>
</tbody>
</table>
<p>A set of constraints is a Python dictionary that uses the real
positioner names (the motors) as the keys. Only those constraints with
changes need be added to the dictionary but it is permissable to
describe all the real positioners. Each value in the dictionary is a
<code class="docutils literal notranslate"><span class="pre">`hkl.diffract.Constraint</span></code> &lt;<a class="reference external" href="https://blueskyproject.io/hklpy/diffract.html#hkl.diffract.Constraint">https://blueskyproject.io/hklpy/diffract.html#hkl.diffract.Constraint</a>&gt;`__,
where the values are specified in this order:
<code class="docutils literal notranslate"><span class="pre">low_limit,</span> <span class="pre">high_limit,</span> <span class="pre">value,</span> <span class="pre">fit</span></code>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">fit</span></code></p></th>
<th class="head"><p>constraint</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></td>
<td><p>Only accept solutions with
positions between <code class="docutils literal notranslate"><span class="pre">low_limit</span></code>
and <code class="docutils literal notranslate"><span class="pre">high_limit</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">False</span></code></p></td>
<td><p>Do not allow this positioner to
be adjusted and fix its position
to <code class="docutils literal notranslate"><span class="pre">value</span></code>.</p></td>
</tr>
</tbody>
</table>
<p>Apply new constraints using the
<code class="docutils literal notranslate"><span class="pre">`applyConstraints()</span></code> &lt;<a class="reference external" href="https://blueskyproject.io/hklpy/diffract.html#hkl.diffract.Diffractometer.apply_constraints">https://blueskyproject.io/hklpy/diffract.html#hkl.diffract.Diffractometer.apply_constraints</a>&gt;`__
method. These <em>add</em> to the existing constraints, as shown in the table.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hkl</span> <span class="kn">import</span> <span class="n">Constraint</span>
<span class="n">fourc</span><span class="o">.</span><span class="n">apply_constraints</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;tth&quot;</span><span class="p">:</span> <span class="n">Constraint</span><span class="p">(</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="s2">&quot;chi&quot;</span><span class="p">:</span> <span class="n">Constraint</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">fourc</span><span class="o">.</span><span class="n">show_constraints</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=====</span> <span class="o">=========</span> <span class="o">==========</span> <span class="o">=====</span> <span class="o">====</span>
<span class="n">axis</span>  <span class="n">low_limit</span> <span class="n">high_limit</span> <span class="n">value</span> <span class="n">fit</span>
<span class="o">=====</span> <span class="o">=========</span> <span class="o">==========</span> <span class="o">=====</span> <span class="o">====</span>
<span class="n">omega</span> <span class="o">-</span><span class="mf">180.0</span>    <span class="mf">0.001</span>      <span class="mf">0.0</span>   <span class="kc">True</span>
<span class="n">chi</span>   <span class="o">-</span><span class="mf">90.0</span>     <span class="mf">90.0</span>       <span class="mf">0.0</span>   <span class="kc">True</span>
<span class="n">phi</span>   <span class="o">-</span><span class="mf">180.0</span>    <span class="mf">180.0</span>      <span class="mf">0.0</span>   <span class="kc">True</span>
<span class="n">tth</span>   <span class="o">-</span><span class="mf">0.001</span>    <span class="mf">90.0</span>       <span class="mf">0.0</span>   <span class="kc">True</span>
<span class="o">=====</span> <span class="o">=========</span> <span class="o">==========</span> <span class="o">=====</span> <span class="o">====</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">pyRestTable</span><span class="o">.</span><span class="n">rest_table</span><span class="o">.</span><span class="n">Table</span> <span class="n">at</span> <span class="mh">0x7f52ebe68f40</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Then remove (undo) those new additions.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fourc</span><span class="o">.</span><span class="n">undo_last_constraints</span><span class="p">()</span>
<span class="n">fourc</span><span class="o">.</span><span class="n">show_constraints</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">=====</span> <span class="o">=========</span> <span class="o">==========</span> <span class="o">=====</span> <span class="o">====</span>
<span class="n">axis</span>  <span class="n">low_limit</span> <span class="n">high_limit</span> <span class="n">value</span> <span class="n">fit</span>
<span class="o">=====</span> <span class="o">=========</span> <span class="o">==========</span> <span class="o">=====</span> <span class="o">====</span>
<span class="n">omega</span> <span class="o">-</span><span class="mf">180.0</span>    <span class="mf">0.001</span>      <span class="mf">0.0</span>   <span class="kc">True</span>
<span class="n">chi</span>   <span class="o">-</span><span class="mf">180.0</span>    <span class="mf">180.0</span>      <span class="mf">0.0</span>   <span class="kc">True</span>
<span class="n">phi</span>   <span class="o">-</span><span class="mf">180.0</span>    <span class="mf">180.0</span>      <span class="mf">0.0</span>   <span class="kc">True</span>
<span class="n">tth</span>   <span class="o">-</span><span class="mf">0.001</span>    <span class="mf">180.0</span>      <span class="mf">0.0</span>   <span class="kc">True</span>
<span class="o">=====</span> <span class="o">=========</span> <span class="o">==========</span> <span class="o">=====</span> <span class="o">====</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">pyRestTable</span><span class="o">.</span><span class="n">rest_table</span><span class="o">.</span><span class="n">Table</span> <span class="n">at</span> <span class="mh">0x7f52ebe60d30</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="reflection-test">
<h3>(400) reflection test<a class="headerlink" href="#reflection-test" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Check the <code class="docutils literal notranslate"><span class="pre">inverse</span></code> (angles -&gt; (<em>hkl</em>)) computation.</p></li>
<li><p>Check the <code class="docutils literal notranslate"><span class="pre">forward</span></code> ((<em>hkl</em>) -&gt; angles) computation.</p></li>
</ol>
<section id="check-the-inverse-calculation-400">
<h4>Check the inverse calculation: (400)<a class="headerlink" href="#check-the-inverse-calculation-400" title="Permalink to this headline">¶</a></h4>
<p>To calculate the (<em>hkl</em>) corresponding to a given set of motor angles,
call <code class="docutils literal notranslate"><span class="pre">fourc.inverse((h,</span> <span class="pre">k,</span> <span class="pre">l))</span></code>. Note the second set of parentheses
needed by this function.</p>
<p>The values are specified, without names, in the order specified by
<code class="docutils literal notranslate"><span class="pre">fourc.calc.physical_axis_names</span></code>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;axis names:&quot;</span><span class="p">,</span> <span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">physical_axis_names</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">axis</span> <span class="n">names</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="s1">&#39;chi&#39;</span><span class="p">,</span> <span class="s1">&#39;phi&#39;</span><span class="p">,</span> <span class="s1">&#39;tth&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Now, proceed with the inverse calculation.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">fourc</span><span class="o">.</span><span class="n">inverse</span><span class="p">((</span><span class="o">-</span><span class="mf">145.451</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">69.0966</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(4 0 0) ? </span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">h</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">k</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">l</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(4 0 0) ? 4.00 0.00 0.00
</pre></div>
</div>
</section>
<section id="check-the-forward-calculation-400">
<h4>Check the forward calculation: (400)<a class="headerlink" href="#check-the-forward-calculation-400" title="Permalink to this headline">¶</a></h4>
<p>Compute the angles necessary to position the diffractometer for the
given reflection.</p>
<p>Note that for the forward computation, more than one set of angles may
be used to reach the same crystal reflection. This test will report the
<em>default</em> selection. The <em>default</em> selection (which may be changed
through methods described in the <code class="docutils literal notranslate"><span class="pre">hkl.calc</span></code> module) is the first
solution.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 44%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>function</p></th>
<th class="head"><p>returns</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">fourc.forward()</span></code></p></td>
<td><p>The <em>default</em> solution</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">fourc.calc.forward()</span></code></p></td>
<td><p>List of all allowed solutions.</p></td>
</tr>
</tbody>
</table>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">fourc</span><span class="o">.</span><span class="n">forward</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;(400) :&quot;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;tth=</span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">tth</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;omega=</span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">omega</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;chi=</span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">chi</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;phi=</span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">phi</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">400</span><span class="p">)</span> <span class="p">:</span> <span class="n">tth</span><span class="o">=</span><span class="mf">69.0982</span> <span class="n">omega</span><span class="o">=-</span><span class="mf">145.4502</span> <span class="n">chi</span><span class="o">=</span><span class="mf">0.0000</span> <span class="n">phi</span><span class="o">=</span><span class="mf">0.0000</span>
</pre></div>
</div>
</section>
</section>
<section id="id1">
<h3>(040) reflection test<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Repeat the <code class="docutils literal notranslate"><span class="pre">inverse</span></code> and <code class="docutils literal notranslate"><span class="pre">forward</span></code> calculations for the second
orientation reflection.</p>
<section id="check-the-inverse-calculation-040">
<h4>Check the inverse calculation: (040)<a class="headerlink" href="#check-the-inverse-calculation-040" title="Permalink to this headline">¶</a></h4>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">fourc</span><span class="o">.</span><span class="n">inverse</span><span class="p">((</span><span class="o">-</span><span class="mf">145.451</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">69.0966</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(0 4 0) ? </span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">h</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">k</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">l</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(0 4 0) ? 0.00 4.00 0.00
</pre></div>
</div>
</section>
<section id="check-the-forward-calculation-040">
<h4>Check the forward calculation: (040)<a class="headerlink" href="#check-the-forward-calculation-040" title="Permalink to this headline">¶</a></h4>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span> <span class="o">=</span> <span class="n">fourc</span><span class="o">.</span><span class="n">forward</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;(040) :&quot;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;tth=</span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">tth</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;omega=</span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">omega</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;chi=</span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">chi</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;phi=</span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">phi</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">040</span><span class="p">)</span> <span class="p">:</span> <span class="n">tth</span><span class="o">=</span><span class="mf">69.0982</span> <span class="n">omega</span><span class="o">=-</span><span class="mf">145.4502</span> <span class="n">chi</span><span class="o">=</span><span class="mf">90.0000</span> <span class="n">phi</span><span class="o">=</span><span class="mf">0.0000</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="scan-in-reciprocal-space-using-bluesky">
<h2>Scan in reciprocal space using Bluesky<a class="headerlink" href="#scan-in-reciprocal-space-using-bluesky" title="Permalink to this headline">¶</a></h2>
<p>To scan with Bluesky, we need more setup.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>
<span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">SupplementalData</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks.best_effort</span> <span class="kn">import</span> <span class="n">BestEffortCallback</span>
<span class="kn">from</span> <span class="nn">bluesky.magics</span> <span class="kn">import</span> <span class="n">BlueskyMagics</span>
<span class="kn">import</span> <span class="nn">bluesky.plans</span> <span class="k">as</span> <span class="nn">bp</span>
<span class="kn">import</span> <span class="nn">bluesky.plan_stubs</span> <span class="k">as</span> <span class="nn">bps</span>
<span class="kn">import</span> <span class="nn">databroker</span>
<span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">get_ipython</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

<span class="n">bec</span> <span class="o">=</span> <span class="n">BestEffortCallback</span><span class="p">()</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">databroker</span><span class="o">.</span><span class="n">temp</span><span class="p">()</span><span class="o">.</span><span class="n">v1</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">SupplementalData</span><span class="p">()</span>

<span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">register_magics</span><span class="p">(</span><span class="n">BlueskyMagics</span><span class="p">)</span>

<span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>
<span class="n">RE</span><span class="o">.</span><span class="n">md</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">RE</span><span class="o">.</span><span class="n">preprocessors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sd</span><span class="p">)</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">)</span>
<span class="n">RE</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">bec</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span>
</pre></div>
</div>
<section id="h00-scan-near-400">
<h3>(<em>h00</em>) scan near (400)<a class="headerlink" href="#h00-scan-near-400" title="Permalink to this headline">¶</a></h3>
<p>In this example, we have no detector. Still, we add the diffractometer
object in the detector list so that the <em>hkl</em> and motor positions will
appear as columns in the table.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">fourc</span><span class="p">],</span> <span class="n">fourc</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Transient</span> <span class="n">Scan</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">1</span>     <span class="n">Time</span><span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">19</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">09</span>
<span class="n">Persistent</span> <span class="n">Unique</span> <span class="n">Scan</span> <span class="n">ID</span><span class="p">:</span> <span class="s1">&#39;60d5f02f-8ba8-4035-9d74-c37151428675&#39;</span>
<span class="n">New</span> <span class="n">stream</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span>
<span class="o">+-----------+------------+------------+------------+------------+-------------+------------+------------+------------+</span>
<span class="o">|</span>   <span class="n">seq_num</span> <span class="o">|</span>       <span class="n">time</span> <span class="o">|</span>    <span class="n">fourc_h</span> <span class="o">|</span>    <span class="n">fourc_k</span> <span class="o">|</span>    <span class="n">fourc_l</span> <span class="o">|</span> <span class="n">fourc_omega</span> <span class="o">|</span>  <span class="n">fourc_chi</span> <span class="o">|</span>  <span class="n">fourc_phi</span> <span class="o">|</span>  <span class="n">fourc_tth</span> <span class="o">|</span>
<span class="o">+-----------+------------+------------+------------+------------+-------------+------------+------------+------------+</span>
<span class="o">|</span>         <span class="mi">1</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">09.5</span> <span class="o">|</span>      <span class="mf">3.900</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">146.431</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">67.137</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">2</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">10.0</span> <span class="o">|</span>      <span class="mf">3.950</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">145.942</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">68.115</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">3</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">10.6</span> <span class="o">|</span>      <span class="mf">4.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">145.450</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">69.098</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">4</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">11.1</span> <span class="o">|</span>      <span class="mf">4.050</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">144.956</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">70.087</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">5</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">11.7</span> <span class="o">|</span>      <span class="mf">4.100</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">144.458</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">71.083</span> <span class="o">|</span>
<span class="o">+-----------+------------+------------+------------+------------+-------------+------------+------------+------------+</span>
<span class="n">generator</span> <span class="n">scan</span> <span class="p">[</span><span class="s1">&#39;60d5f02f&#39;</span><span class="p">]</span> <span class="p">(</span><span class="n">scan</span> <span class="n">num</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">prjemian</span><span class="o">/.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">bluesky</span><span class="o">/</span><span class="n">callbacks</span><span class="o">/</span><span class="n">fitting</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">165</span><span class="p">:</span> <span class="ne">RuntimeWarning</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">value</span> <span class="n">encountered</span> <span class="ow">in</span> <span class="n">double_scalars</span>
  <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">input</span> <span class="o">*</span> <span class="n">grids</span><span class="p">[</span><span class="nb">dir</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">labels</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="o">/</span> <span class="n">normalizer</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;60d5f02f-8ba8-4035-9d74-c37151428675&#39;</span><span class="p">,)</span>
</pre></div>
</div>
<img alt="../../_images/geo_e4cv_42_4.png" src="../../_images/geo_e4cv_42_4.png" />
</section>
<section id="chi-scan-from-400-to-040">
<h3>chi scan from (400) to (040)<a class="headerlink" href="#chi-scan-from-400-to-040" title="Permalink to this headline">¶</a></h3>
<p>If we do this with <span class="math notranslate nohighlight">\(\omega=-145.4500\)</span> and <span class="math notranslate nohighlight">\(2\theta=69.0985\)</span>,
this will be a scan between the two orientation reflections.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">%mov</span></code> (IPython <em>magic</em> command) to move both motors at the same
time.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;possible modes:&quot;</span><span class="p">,</span> <span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;chosen mode:&quot;</span><span class="p">,</span> <span class="n">fourc</span><span class="o">.</span><span class="n">calc</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="c1"># same as orientation reflections</span>
<span class="o">%</span><span class="k">mov</span> fourc.omega -145.4500 fourc.tth 69.0985

<span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">fourc</span><span class="p">],</span> <span class="n">fourc</span><span class="o">.</span><span class="n">chi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">possible</span> <span class="n">modes</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;bissector&#39;</span><span class="p">,</span> <span class="s1">&#39;constant_omega&#39;</span><span class="p">,</span> <span class="s1">&#39;constant_chi&#39;</span><span class="p">,</span> <span class="s1">&#39;constant_phi&#39;</span><span class="p">,</span> <span class="s1">&#39;double_diffraction&#39;</span><span class="p">,</span> <span class="s1">&#39;psi_constant&#39;</span><span class="p">]</span>
<span class="n">chosen</span> <span class="n">mode</span><span class="p">:</span> <span class="n">constant_phi</span>


<span class="n">Transient</span> <span class="n">Scan</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">2</span>     <span class="n">Time</span><span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">19</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">13</span>
<span class="n">Persistent</span> <span class="n">Unique</span> <span class="n">Scan</span> <span class="n">ID</span><span class="p">:</span> <span class="s1">&#39;db8f0264-bb9d-49eb-9aae-0e90a5e42001&#39;</span>
<span class="n">New</span> <span class="n">stream</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span>
<span class="o">+-----------+------------+------------+------------+------------+------------+-------------+------------+------------+</span>
<span class="o">|</span>   <span class="n">seq_num</span> <span class="o">|</span>       <span class="n">time</span> <span class="o">|</span>  <span class="n">fourc_chi</span> <span class="o">|</span>    <span class="n">fourc_h</span> <span class="o">|</span>    <span class="n">fourc_k</span> <span class="o">|</span>    <span class="n">fourc_l</span> <span class="o">|</span> <span class="n">fourc_omega</span> <span class="o">|</span>  <span class="n">fourc_phi</span> <span class="o">|</span>  <span class="n">fourc_tth</span> <span class="o">|</span>
<span class="o">+-----------+------------+------------+------------+------------+------------+-------------+------------+------------+</span>
<span class="o">|</span>         <span class="mi">1</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">13.4</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>      <span class="mf">4.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">145.450</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">69.099</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">2</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">13.9</span> <span class="o">|</span>     <span class="mf">10.000</span> <span class="o">|</span>      <span class="mf">3.939</span> <span class="o">|</span>      <span class="mf">0.695</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">145.450</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">69.099</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">3</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">14.6</span> <span class="o">|</span>     <span class="mf">20.000</span> <span class="o">|</span>      <span class="mf">3.759</span> <span class="o">|</span>      <span class="mf">1.368</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">145.450</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">69.099</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">4</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">15.3</span> <span class="o">|</span>     <span class="mf">30.000</span> <span class="o">|</span>      <span class="mf">3.464</span> <span class="o">|</span>      <span class="mf">2.000</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">145.450</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">69.099</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">5</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">15.9</span> <span class="o">|</span>     <span class="mf">40.000</span> <span class="o">|</span>      <span class="mf">3.064</span> <span class="o">|</span>      <span class="mf">2.571</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">145.450</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">69.099</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">6</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">16.4</span> <span class="o">|</span>     <span class="mf">50.000</span> <span class="o">|</span>      <span class="mf">2.571</span> <span class="o">|</span>      <span class="mf">3.064</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">145.450</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">69.099</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">7</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">17.0</span> <span class="o">|</span>     <span class="mf">60.000</span> <span class="o">|</span>      <span class="mf">2.000</span> <span class="o">|</span>      <span class="mf">3.464</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">145.450</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">69.099</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">8</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">17.5</span> <span class="o">|</span>     <span class="mf">70.000</span> <span class="o">|</span>      <span class="mf">1.368</span> <span class="o">|</span>      <span class="mf">3.759</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">145.450</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">69.099</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">9</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">18.0</span> <span class="o">|</span>     <span class="mf">80.000</span> <span class="o">|</span>      <span class="mf">0.695</span> <span class="o">|</span>      <span class="mf">3.939</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">145.450</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">69.099</span> <span class="o">|</span>
<span class="o">|</span>        <span class="mi">10</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">18.5</span> <span class="o">|</span>     <span class="mf">90.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>      <span class="mf">4.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">145.450</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>     <span class="mf">69.099</span> <span class="o">|</span>
<span class="o">+-----------+------------+------------+------------+------------+------------+-------------+------------+------------+</span>
<span class="n">generator</span> <span class="n">scan</span> <span class="p">[</span><span class="s1">&#39;db8f0264&#39;</span><span class="p">]</span> <span class="p">(</span><span class="n">scan</span> <span class="n">num</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;db8f0264-bb9d-49eb-9aae-0e90a5e42001&#39;</span><span class="p">,)</span>
</pre></div>
</div>
<img alt="../../_images/geo_e4cv_44_2.png" src="../../_images/geo_e4cv_44_2.png" />
</section>
<section id="k0-scan-near-040">
<h3>(<em>0k0</em>) scan near (040)<a class="headerlink" href="#k0-scan-near-040" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">fourc</span><span class="p">],</span> <span class="n">fourc</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Transient</span> <span class="n">Scan</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">3</span>     <span class="n">Time</span><span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">19</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">20</span>
<span class="n">Persistent</span> <span class="n">Unique</span> <span class="n">Scan</span> <span class="n">ID</span><span class="p">:</span> <span class="s1">&#39;90e9bb44-1528-4554-8aab-af4e3e47e678&#39;</span>
<span class="n">New</span> <span class="n">stream</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span>
<span class="o">+-----------+------------+------------+------------+------------+-------------+------------+------------+------------+</span>
<span class="o">|</span>   <span class="n">seq_num</span> <span class="o">|</span>       <span class="n">time</span> <span class="o">|</span>    <span class="n">fourc_k</span> <span class="o">|</span>    <span class="n">fourc_h</span> <span class="o">|</span>    <span class="n">fourc_l</span> <span class="o">|</span> <span class="n">fourc_omega</span> <span class="o">|</span>  <span class="n">fourc_chi</span> <span class="o">|</span>  <span class="n">fourc_phi</span> <span class="o">|</span>  <span class="n">fourc_tth</span> <span class="o">|</span>
<span class="o">+-----------+------------+------------+------------+------------+-------------+------------+------------+------------+</span>
<span class="o">|</span>         <span class="mi">1</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">20.3</span> <span class="o">|</span>      <span class="mf">3.900</span> <span class="o">|</span>      <span class="mf">4.100</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">126.652</span> <span class="o">|</span>     <span class="mf">43.568</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">106.695</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">2</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">20.8</span> <span class="o">|</span>      <span class="mf">3.950</span> <span class="o">|</span>      <span class="mf">4.100</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">126.179</span> <span class="o">|</span>     <span class="mf">43.933</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">107.641</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">3</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">21.4</span> <span class="o">|</span>      <span class="mf">4.000</span> <span class="o">|</span>      <span class="mf">4.100</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">125.697</span> <span class="o">|</span>     <span class="mf">44.293</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">108.604</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">4</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">21.9</span> <span class="o">|</span>      <span class="mf">4.050</span> <span class="o">|</span>      <span class="mf">4.100</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">125.206</span> <span class="o">|</span>     <span class="mf">44.648</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">109.585</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">5</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">22.5</span> <span class="o">|</span>      <span class="mf">4.100</span> <span class="o">|</span>      <span class="mf">4.100</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">124.707</span> <span class="o">|</span>     <span class="mf">45.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">110.585</span> <span class="o">|</span>
<span class="o">+-----------+------------+------------+------------+------------+-------------+------------+------------+------------+</span>
<span class="n">generator</span> <span class="n">scan</span> <span class="p">[</span><span class="s1">&#39;90e9bb44&#39;</span><span class="p">]</span> <span class="p">(</span><span class="n">scan</span> <span class="n">num</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;90e9bb44-1528-4554-8aab-af4e3e47e678&#39;</span><span class="p">,)</span>
</pre></div>
</div>
<img alt="../../_images/geo_e4cv_46_2.png" src="../../_images/geo_e4cv_46_2.png" />
</section>
<section id="hk0-scan-near-440">
<h3>(<em>hk0</em>) scan near (440)<a class="headerlink" href="#hk0-scan-near-440" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">fourc</span><span class="p">],</span> <span class="n">fourc</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="n">fourc</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Transient</span> <span class="n">Scan</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">4</span>     <span class="n">Time</span><span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">19</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">24</span>
<span class="n">Persistent</span> <span class="n">Unique</span> <span class="n">Scan</span> <span class="n">ID</span><span class="p">:</span> <span class="s1">&#39;289b70e8-2da2-47dc-a795-99237a567fcf&#39;</span>
<span class="n">New</span> <span class="n">stream</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span>
<span class="o">+-----------+------------+------------+------------+------------+-------------+------------+------------+------------+</span>
<span class="o">|</span>   <span class="n">seq_num</span> <span class="o">|</span>       <span class="n">time</span> <span class="o">|</span>    <span class="n">fourc_h</span> <span class="o">|</span>    <span class="n">fourc_k</span> <span class="o">|</span>    <span class="n">fourc_l</span> <span class="o">|</span> <span class="n">fourc_omega</span> <span class="o">|</span>  <span class="n">fourc_chi</span> <span class="o">|</span>  <span class="n">fourc_phi</span> <span class="o">|</span>  <span class="n">fourc_tth</span> <span class="o">|</span>
<span class="o">+-----------+------------+------------+------------+------------+-------------+------------+------------+------------+</span>
<span class="o">|</span>         <span class="mi">1</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">24.2</span> <span class="o">|</span>      <span class="mf">3.900</span> <span class="o">|</span>      <span class="mf">3.900</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">128.558</span> <span class="o">|</span>     <span class="mf">45.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">102.882</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">2</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">24.6</span> <span class="o">|</span>      <span class="mf">3.950</span> <span class="o">|</span>      <span class="mf">3.950</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">127.627</span> <span class="o">|</span>     <span class="mf">45.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">104.744</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">3</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">25.0</span> <span class="o">|</span>      <span class="mf">4.000</span> <span class="o">|</span>      <span class="mf">4.000</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">126.676</span> <span class="o">|</span>     <span class="mf">45.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">106.647</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">4</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">25.4</span> <span class="o">|</span>      <span class="mf">4.050</span> <span class="o">|</span>      <span class="mf">4.050</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">125.703</span> <span class="o">|</span>     <span class="mf">45.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">108.592</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">5</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">25.8</span> <span class="o">|</span>      <span class="mf">4.100</span> <span class="o">|</span>      <span class="mf">4.100</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">124.707</span> <span class="o">|</span>     <span class="mf">45.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">110.585</span> <span class="o">|</span>
<span class="o">+-----------+------------+------------+------------+------------+-------------+------------+------------+------------+</span>
<span class="n">generator</span> <span class="n">scan</span> <span class="p">[</span><span class="s1">&#39;289b70e8&#39;</span><span class="p">]</span> <span class="p">(</span><span class="n">scan</span> <span class="n">num</span><span class="p">:</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;289b70e8-2da2-47dc-a795-99237a567fcf&#39;</span><span class="p">,)</span>
</pre></div>
</div>
<img alt="../../_images/geo_e4cv_48_2.png" src="../../_images/geo_e4cv_48_2.png" />
<p>Move to the (<em>440</em>) reflection.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fourc</span><span class="o">.</span><span class="n">move</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fourc</span><span class="o">.</span><span class="n">position</span> <span class="si">= }</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fourc</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">FourCirclePseudoPos</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">4.000000000000001</span><span class="p">,</span> <span class="n">l</span><span class="o">=-</span><span class="mf">1.1471889002931275e-15</span><span class="p">)</span>
</pre></div>
</div>
<p>Repeat the same scan about the (<em>440</em>) but use <em>relative</em> positions.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">rel_scan</span><span class="p">([</span><span class="n">fourc</span><span class="p">],</span> <span class="n">fourc</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">fourc</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Transient</span> <span class="n">Scan</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">5</span>     <span class="n">Time</span><span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">19</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">27</span>
<span class="n">Persistent</span> <span class="n">Unique</span> <span class="n">Scan</span> <span class="n">ID</span><span class="p">:</span> <span class="s1">&#39;197bb65c-e257-4aa3-a002-358fa4089834&#39;</span>
<span class="n">New</span> <span class="n">stream</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span>
<span class="o">+-----------+------------+------------+------------+------------+-------------+------------+------------+------------+</span>
<span class="o">|</span>   <span class="n">seq_num</span> <span class="o">|</span>       <span class="n">time</span> <span class="o">|</span>    <span class="n">fourc_h</span> <span class="o">|</span>    <span class="n">fourc_k</span> <span class="o">|</span>    <span class="n">fourc_l</span> <span class="o">|</span> <span class="n">fourc_omega</span> <span class="o">|</span>  <span class="n">fourc_chi</span> <span class="o">|</span>  <span class="n">fourc_phi</span> <span class="o">|</span>  <span class="n">fourc_tth</span> <span class="o">|</span>
<span class="o">+-----------+------------+------------+------------+------------+-------------+------------+------------+------------+</span>
<span class="o">|</span>         <span class="mi">1</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">27.1</span> <span class="o">|</span>      <span class="mf">3.900</span> <span class="o">|</span>      <span class="mf">3.900</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">128.558</span> <span class="o">|</span>     <span class="mf">45.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">102.882</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">2</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">27.5</span> <span class="o">|</span>      <span class="mf">3.950</span> <span class="o">|</span>      <span class="mf">3.950</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">127.627</span> <span class="o">|</span>     <span class="mf">45.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">104.744</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">3</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">27.9</span> <span class="o">|</span>      <span class="mf">4.000</span> <span class="o">|</span>      <span class="mf">4.000</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">126.676</span> <span class="o">|</span>     <span class="mf">45.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">106.647</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">4</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">28.3</span> <span class="o">|</span>      <span class="mf">4.050</span> <span class="o">|</span>      <span class="mf">4.050</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">125.703</span> <span class="o">|</span>     <span class="mf">45.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">108.592</span> <span class="o">|</span>
<span class="o">|</span>         <span class="mi">5</span> <span class="o">|</span> <span class="mi">16</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">28.7</span> <span class="o">|</span>      <span class="mf">4.100</span> <span class="o">|</span>      <span class="mf">4.100</span> <span class="o">|</span>     <span class="o">-</span><span class="mf">0.000</span> <span class="o">|</span>    <span class="o">-</span><span class="mf">124.707</span> <span class="o">|</span>     <span class="mf">45.000</span> <span class="o">|</span>      <span class="mf">0.000</span> <span class="o">|</span>    <span class="mf">110.585</span> <span class="o">|</span>
<span class="o">+-----------+------------+------------+------------+------------+-------------+------------+------------+------------+</span>
<span class="n">generator</span> <span class="n">rel_scan</span> <span class="p">[</span><span class="s1">&#39;197bb65c&#39;</span><span class="p">]</span> <span class="p">(</span><span class="n">scan</span> <span class="n">num</span><span class="p">:</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;197bb65c-e257-4aa3-a002-358fa4089834&#39;</span><span class="p">,)</span>
</pre></div>
</div>
<img alt="../../_images/geo_e4cv_52_2.png" src="../../_images/geo_e4cv_52_2.png" />
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="geo_e6c.html" class="btn btn-neutral float-right" title="E6C : 6-circle diffractometer example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014-2021, Brookhaven National Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>