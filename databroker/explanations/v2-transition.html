
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>What are the API versions v0, v1, v2? &mdash; databroker 1.2.5.post9+gf7b9672d documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How can it be used locally and remotely?" href="local-and-remote-use-cases.html" />
    <link rel="prev" title="How to create a new Catalog backed by MongoDB" href="../how-to/mongo-backed-catalog.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> databroker
          </a>
              <div class="version">
                1.2.5.post9+gf7b9672d
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/install.html">Installation Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/search-and-lookup.html">Find Runs in a Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/get-data.html">Get Data from a Run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/get-metadata.html">Navigate Metadata in a Run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/export.html">Export Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how-to/download-data-samples.html">How to download some Catalogs with data samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/file-backed-catalog.html">How to create a new Catalog backed by files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/store-data-from-run-engine.html">How to store data from the Run Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/store-analysis-results.html">How to store analysis results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/mongo-backed-catalog.html">How to create a new Catalog backed by MongoDB</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">What are the API versions v0, v1, v2?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#which-interface-should-i-use">Which interface should I use?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#do-they-use-the-same-storage">Do they use the same storage?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i-use-them">How do I use them?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="local-and-remote-use-cases.html">How can it be used locally and remotely?</a></li>
<li class="toctree-l1"><a class="reference internal" href="relationship-to-intake.html">What is Databroker’s relationship to Intake?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/v2.html">New (v2) API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/v1.html">Original (v1 / v0) API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/configuration.html">Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/changelog.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bluesky Project</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io">Homepage</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/bluesky">GitHub</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://gitter.im/NSLS-II/DAMA">Gitter</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">databroker</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>What are the API versions v0, v1, v2?</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/explanations/v2-transition.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="what-are-the-api-versions-v0-v1-v2">
<span id="v2-transition"></span><h1>What are the API versions v0, v1, v2?<a class="headerlink" href="#what-are-the-api-versions-v0-v1-v2" title="Permalink to this headline">¶</a></h1>
<p>The Databroker codebase currently contains two complete and mostly independent
implementations. One is the original implementation from 2015. The other is a
rewrite performed in 2019–2020, written to leverage the scientific Python
libraries <a class="reference external" href="https://dask.org/">dask</a>, <a class="reference external" href="https://intake.readthedocs.io">intake</a>, and <a class="reference external" href="https://xarray.pydata.org/">xarray</a>, which emerged or reached maturity
some time after 2015. Databroker 1.x provides three public interfaces on top of
these two implementations.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 11%" />
<col style="width: 17%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>API version</p></th>
<th class="head"><p>Interface</p></th>
<th class="head"><p>Implementation</p></th>
<th class="head"><p>Who should use it?</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>v2</p></td>
<td><p>New</p></td>
<td><p>New</p></td>
<td><p>All new users</p></td>
</tr>
<tr class="row-odd"><td><p>v1</p></td>
<td><p>Original</p></td>
<td><p>New</p></td>
<td><p>Users with old scripts that use original interface</p></td>
</tr>
<tr class="row-even"><td><p>v0</p></td>
<td><p>Original</p></td>
<td><p>Original</p></td>
<td><p>Users who hit bugs in v1/v2 and need a fallback</p></td>
</tr>
</tbody>
</table>
<section id="which-interface-should-i-use">
<h2>Which interface should I use?<a class="headerlink" href="#which-interface-should-i-use" title="Permalink to this headline">¶</a></h2>
<p>If you are a new user, use v2. That is the version covered by the tutorials and
user guides.</p>
<p>As far as we know the only heavy users of the “original” 2015 interface are at
NSLS-II. If you are such a user and you have have existing scripts using that
original interface, know that we committed to supporting it for many years to
come. We do not want to break your scripts. Consider using v2 for <em>new</em> work,
however, to enjoy its improved usability and feature set.</p>
</section>
<section id="do-they-use-the-same-storage">
<h2>Do they use the same storage?<a class="headerlink" href="#do-they-use-the-same-storage" title="Permalink to this headline">¶</a></h2>
<p>Both implemenations integrate with <a class="reference external" href="https://blueskyproject.io/event-model/external.html">external assets</a> (e.g. large arrays from
imaging detectors) in exactly the same way.</p>
<p>Both use the same MongoDB storage layout for Bluesky documents. You can access
the same MongoDB database from v0, v1, and v2, moving between them seamlessly.</p>
<p>However, the original (v0) implementation also supported sqlite for very
lightweight use cases and had an experimental HDF5-based storage. Both of these
are deprecated. Instead, the new implementation (v2 / v1)  adds support for
msgpack- and JSONL-backed storage, which have proven to be a better solution
for very lightweight use cases. (See <a class="reference internal" href="../reference/configuration.html#migration-from-v0-storage"><span class="std std-ref">Migrating sqlite or HDF5 storage to a format supported by v2 / v1</span></a>.) More
are storage options are planned for early 2021, with an emphasis on efficient
binary formats, such as <a class="reference external" href="https://tiledb.com/">TileDB</a>.</p>
</section>
<section id="how-do-i-use-them">
<h2>How do I use them?<a class="headerlink" href="#how-do-i-use-them" title="Permalink to this headline">¶</a></h2>
<p>All of the tutorials now use <code class="docutils literal notranslate"><span class="pre">databroker.v2</span></code>. As they show, this gets you a
v2-style catalog.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># v2, recommended for new users</span>
<span class="kn">import</span> <span class="nn">databroker</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">databroker</span><span class="o">.</span><span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;MY CATALOG NAME&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>This older-style usage gets you a v1-style catalog.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># v1, supported for existing users supporting old code</span>
<span class="kn">from</span> <span class="nn">databroker</span> <span class="kn">import</span> <span class="n">Broker</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">Broker</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s2">&quot;MY CATALOG NAME&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Since there are just different interfaces built on the same underlying (new)
implementation, we can easily to move between them.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">catalog</span>  <span class="c1"># v2</span>
<span class="n">catalog</span><span class="o">.</span><span class="n">v1</span>  <span class="c1"># v1</span>
<span class="n">catalog</span><span class="o">.</span><span class="n">v2</span>  <span class="c1"># v2  (just returns a reference to itself)</span>
<span class="n">db</span>  <span class="c1"># v1</span>
<span class="n">db</span><span class="o">.</span><span class="n">v1</span>  <span class="c1"># v1  (just returns a reference to itself)</span>
<span class="n">db</span><span class="o">.</span><span class="n">v2</span>  <span class="c1"># v2</span>
</pre></div>
</div>
<p>Therefore, code written like</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">catalog_or_db</span><span class="p">):</span>
    <span class="n">catalog</span> <span class="o">=</span> <span class="n">catalog_or_db</span><span class="o">.</span><span class="n">v2</span>  <span class="c1"># ensure we have a v2 interface</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>will work on both v1-style and v2-style.</p>
<p>Finally, the v0 implementation is available as the battle-tested emergency
fallback in case of any show-stopping bugs the newer implementation underlying
v1 and v2. You <em>cannot</em> move between v0 and other interfaces. You can invoke v0
like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># v0, emergency fallback if v1/v2 is broken</span>
<span class="kn">from</span> <span class="nn">databroker.v0</span> <span class="kn">import</span> <span class="n">Broker</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">Broker</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s2">&quot;MY CATALOG NAME&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the future, we will remove v0 from the codebase; v1 will be sufficient to
support old user code.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../how-to/mongo-backed-catalog.html" class="btn btn-neutral float-left" title="How to create a new Catalog backed by MongoDB" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="local-and-remote-use-cases.html" class="btn btn-neutral float-right" title="How can it be used locally and remotely?" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015 Brookhaven National Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>